<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Coop Resources — V1 (números + botones)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
    <link href="~/css/Index.css" rel="stylesheet" />

    <style>
        body {
            background: #0b1220;
            color: #e6e8ef;
        }

        .card {
            background: #121a2b;
            border: 1px solid #223150;
        }

        .brand {
            letter-spacing: .5px;
        }

        .resource-value {
            font-variant-numeric: tabular-nums;
        }

        .finished {
            background: linear-gradient(135deg, #0a7d40, #0f5132);
            color: #d1f5e1;
            border: 1px solid #198754;
        }

        .muted {
            color: #b8bfd3;
        }

        .badge-soft {
            background: #1b2742;
            color: #9fb4ff;
        }

        .btn-resource {
            min-width: 140px;
        }

        .small-note {
            font-size: .9rem;
        }

        .resource-counter {
            background: #1b2742;
            border: 1px solid #3d4956;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
        }

        .resource-current {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffffff;
            line-height: 1;
            margin-bottom: 0.25rem;
        }

        .resource-total {
            font-size: 1rem;
            color: #9fb4ff;
            font-weight: 500;
        }

        .form-control:focus {
            background: #1b2742 !important;
            border-color: #4dabf7 !important;
            box-shadow: 0 0 0 0.25rem rgba(77, 171, 247, 0.25) !important;
            color: #ffffff !important;
        }

        .is-invalid {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25) !important;
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-dark border-bottom border-secondary-subtle" style="background:#0b1220;">
        <div class="container">
            <a class="navbar-brand brand d-flex align-items-center gap-2" href="#">
                <span class="fw-bold">Coopera</span>
                <span class="badge rounded-pill text-bg-secondary">V2 (minijuegos)</span>
            </a>
            <div class="d-flex align-items-center gap-3">
                <span id="playerNameDisplay" class="muted">
                    Jugador: <em>@(ViewBag.NombreJugador ?? "—")</em>
                </span>
                <button id="changeNameBtn" class="btn btn-sm btn-outline-light">Ingresar nombre</button>
            </div>
        </div>
    </nav>

    <!-- Main -->
    <main id="mainContainer"
          class="container py-4"
          data-partida-id="@ViewBag.PartidaId"
          data-requiere-nombre="@ViewBag.RequiereNombre"
          data-madera-actual="@ViewBag.TotalMadera"
          data-piedra-actual="@ViewBag.TotalPiedra"
          data-comida-actual="@ViewBag.TotalComida"
          data-meta-madera="@ViewBag.MetaMadera"
          data-meta-piedra="@ViewBag.MetaPiedra"
          data-meta-comida="@ViewBag.MetaComida">

        <!-- Tiempo de la partida -->
        <div id="tiempoPartidaCompleta" class="text-center mt-3 d-none">
            <div class="alert finished fw-bold mb-0">
                ¡Partida terminada! Tiempo: <span id="tiempoPartidaValor"></span>
            </div>
        </div>

        <!-- Metas -->
        <div class="row g-3 mb-3" id="targetsRow">
            <!-- Madera -->
            <div class="col-12 col-lg-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column text-center">
                        <h5 class="card-title mb-3 text-white">Madera</h5>
                        <div class="resource-counter mb-3">
                            <div class="resource-current" id="maderaActual">@ViewBag.TotalMadera</div>
                            <div class="resource-total">de <span id="woodTotal">@ViewBag.MetaMadera</span></div>
                        </div>
                        <p class="card-text muted small-note mb-4">Suma 1 por click.</p>
                        <div class="mt-auto d-grid">
                            <button id="btnRecolectarMadera"
                                    class="btn btn-primary btn-resource"
                                    @(ViewBag.MaderaLlena ? "disabled" : "")>
                                +1 Madera
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Piedra -->
            <div class="col-12 col-lg-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column text-center">
                        <h5 class="card-title mb-3 text-white">Piedra</h5>
                        <div class="resource-counter mb-3">
                            <div class="resource-current" id="piedraActual">@ViewBag.TotalPiedra</div>
                            <div class="resource-total">de <span id="stoneTotal">@ViewBag.MetaPiedra</span></div>
                        </div>
                        <p class="card-text muted small-note mb-4">Suma 1 por click.</p>
                        <div class="mt-auto d-grid">
                            <button id="btnRecolectarPiedra"
                                    class="btn btn-warning btn-resource"
                                    @(ViewBag.PiedraLlena ? "disabled" : "")>
                                +1 Piedra
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comida -->
            <div class="col-12 col-lg-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column text-center">
                        <h5 class="card-title mb-3 text-white">Comida</h5>
                        <div class="resource-counter mb-3">
                            <div class="resource-current" id="comidaActual">@ViewBag.TotalComida</div>
                            <div class="resource-total">de <span id="foodTotal">@ViewBag.MetaComida</span></div>
                        </div>
                        <p class="card-text muted small-note mb-4">Suma 1 por click.</p>
                        <div class="mt-auto d-grid">
                            <button id="btnRecolectarComida"
                                    class="btn btn-success btn-resource"
                                    @(ViewBag.ComidaLlena ? "disabled" : "")>
                                +1 Comida
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráfico de progreso -->
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title text-white mb-3">Progreso de recursos</h5>
                <div style="position:relative; height: 280px;">
                    <canvas id="graficoProgreso"></canvas>
                </div>
                <div class="form-text text-muted">Actualiza automáticamente cada 5 segundos.</div>
            </div>
        </div>

        <!-- Tabla de resultados -->
        <div id="tablaResultados" class="container mt-4 d-none">
            <h3 class="text-center text-white mb-3">Resultados Finales</h3>
            <div class="table-responsive">
                <table class="table table-dark table-striped text-center mb-0">
                    <thead>
                        <tr>
                            <th>Jugador</th>
                            <th>Madera</th>
                            <th>Piedra</th>
                            <th>Comida</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="tablaResultadosBody"></tbody>
                </table>
            </div>
            <div>
                <button id="btnReiniciar" class="btn btn-success">Reiniciar Partida</button>
            </div>
        </div>

    </main>


    <!-- Modal para cambiar nombre -->
    <div class="modal fade" id="changeNameModal" tabindex="-1" aria-labelledby="changeNameModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #121a2b; border: 1px solid #223150;">
                <div class="modal-header border-bottom border-secondary-subtle">
                    <h5 class="modal-title text-white" id="changeNameModalLabel">Cambiar nombre</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="changeNameForm">
                        <div class="mb-3">
                            <label for="nombre" class="form-label text-white">Ingresa tu nombre:</label>
                            <input type="text" class="form-control" id="nombre" placeholder="Ej: MatiasV" maxlength="20" required>
                            <div class="form-text text-muted">Máximo 20 caracteres</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-top border-secondary-subtle">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="acceptNameChange">Aceptar</button>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal Minijuego -->
    <div class="modal fade" id="miniGameModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background:#121a2b; border:1px solid #223150;">
                <div class="modal-header border-bottom border-secondary-subtle">
                    <h5 class="modal-title text-white">Minijuego</h5>
                    <button type="button" class="btn-close btn-close-white" id="miniGameCloseX" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2">
                        <span class="badge bg-secondary" id="miniGameCountdown">60</span>
                    </div>
                    <div class="text-white mb-2" id="miniGameEnunciado">—</div>
                    <div class="text-center my-2">
                        <div id="miniGameSecuencia" class="display-6"></div>
                    </div>
                    <div class="text-white mb-3" id="miniGamePregunta" style="opacity:.9;"></div>
                    <div id="miniGameDynamicArea"></div>
                    <div class="mt-3 d-flex gap-2 justify-content-end">
                        <button type="button" class="btn btn-secondary" id="miniGameCancel">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="miniGameSubmit">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <!-- Nuestro JS -->
    <script src="~/js/Index.js"></script>
</body>
</html>
